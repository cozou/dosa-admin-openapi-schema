openapi: "3.0.2"
servers:
  - url: http://localhost:8000
info:
  description: RESTful API of DOSA管理システム
  version: v1
  title: DOSA管理API
  contact: {}
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
tags:
  - name: DosaAdmin
    description: DOSA管理API
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-KEY
  responses:
    UnauthorizedError:
      description: API key is missing or invalid
      headers:
        WWW_Authenticate:
          schema:
            type: string
    BadRequestError:
      description: invalid request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
  schemas:
    Error:
      type: object
      properties:
        messages:
          type: string
      required:
        - messages
    Participant:
      type: object
      properties:
        participant_id:
          type: integer
          format: int32
          description: 測定者ID
        name:
          type: string
          example: 測定 太郎
          description: 氏名
        name_kana:
          type: string
          example: ソクテイ タロウ
          description: 氏名（カナ）
        sex:
          type: integer
          enum:
            - 1
            - 2
          description: "性別（1:男性, 2:女性）"
        birthday:
          type: string
          format: date
          description: 生年月日
        mail_address:
          type: string
          format: email
          description: メールアドレス
          example: user1@example.com
      required:
        - participant_id
        - name
        - name_kana
        - sex
        - birthday
        - mail_address
      description: 測定者
    ParticipantMeasurementMeet:
      type: object
      properties:
        participant_id:
          type: integer
          format: int32
          description: 測定者ID
        meet_id:
          type: integer
          example: 868064
          description: 測定会ID
        measurement_id:
          type: integer
          example: 1
          description: 測定結果ID
        meet_name:
          type: string
          example: 東京テスト測定会
          description: 測定会名
        start_date:
          type: string
          format: date
          description: 測定会実施日
        start_time:
          type: string
          example: "10:00"
          description: 開始時間
      required:
        - participant_id
        - meet_id
        - measurement_id
        - meet_name
        - start_date
        - start_time
      description: 参加測定会
    Measurement:
      type: object
      properties:
        participant_id:
          type: integer
          format: int32
          description: 測定者ID
        meet_id:
          type: integer
          example: 868064
          description: 測定会ID
        measurement_id:
          type: integer
          example: 1
          description: 測定結果ID
        meet_name:
          type: string
          example: 東京テスト測定会
          description: 測定会名
        start_date:
          type: string
          format: date
          description: 測定会実施日
        name:
          type: string
          example: 測定 太郎
          description: 名前
        sex:
          type: integer
          enum:
            - 1
            - 2
          description: "性別（1:男性, 2:女性）"
        grade:
          type: string
          example: 中2
          description: 学年
        birthday:
          type: string
          format: date
          description: 生年月日
        participate_time:
          type: integer
          format: int32
          example: 1
          description: 参加回数
        height:
          type: number
          format: float
          example: 145.0
          description: 身長(cm)
        weight:
          type: number
          format: float
          example: 50.0
          description: 体重(kg)
        sports_type:
          type: array
          items:
            type: string
            example: サッカー
          description: 習ったスポーツ
        sports_type_other:
          type: string
          example: フットサル
          description: その他の習ったスポーツ
        team_name:
          type: string
          example: 測定チーム
          description: 所属チーム名
        version:
          type: number
          format: float
          example: 1.00
          description: バージョン
        results:
          type: object
          properties:
            dash_10:
              $ref: "#/components/schemas/MeasurementData"
              description: 10mスプリント
            endurance_long:
              $ref: "#/components/schemas/MeasurementData"
              description: 長持久力
            endurance_short:
              $ref: "#/components/schemas/MeasurementData"
              description: 短持久力
            jump:
              $ref: "#/components/schemas/MeasurementData"
              description: ジャンプ力
            agility:
              $ref: "#/components/schemas/MeasurementData"
              description: 敏しょう性
            step_visual_response:
              $ref: "#/components/schemas/MeasurementData"
              description: 視覚反応力
            step_power:
              $ref: "#/components/schemas/MeasurementData"
              description: ステップ力
            swing_speed:
              $ref: "#/components/schemas/MeasurementData"
              description: スイングスピード
            balance_l:
              $ref: "#/components/schemas/MeasurementData"
              description: バランス力（左足）
            balance_r:
              $ref: "#/components/schemas/MeasurementData"
              description: バランス力（右足）
            balance_lr_difference:
              $ref: "#/components/schemas/MeasurementData"
              description: バランス力（左右差）
          required:
            - tenSprint
            - enduranceLong
            - enduranceShort
            - agility
            - stepVisualResponse
            - stepPower
            - swingSpeed
            - jump
            - balanceLeft
            - balanceRight
            - balanceGap
          description: 測定結果
        advice:
          type: object
          properties:
            summary:
              type: string
              example: 「スイングスピード」「長持久力」があなたの運動能力の武器となります。この能力を活かせるスポーツ種目、プレースタイルを考えてあなたを最大限に発揮してください。また、「バランス力（左右差）」「バランス力（左足）」はあなたの苦手な動きです。トレーナーに苦手を克服するトレーニング方法を確認してできるだけ苦手をなくしてください。苦手をなくすと今まで以上のパフォーマンスを発揮できるでしょう。
              description: 概要
            recommend_sports:
              type: array
              items:
                type: string
              minItems: 10
              maxItems: 10
              example:
                - テニス
                - ボクシング
                - バトミントン
                - 水泳（長距離）
                - 卓球
                - 柔道
                - 水泳（短距離）
                - ホッケー
                - 剣道
                - テコンドー
              description: 向いているスポーツ
            recommend_ability:
              type: array
              items:
                type: object
                properties:
                  ability:
                    type: string
                    example: スイングスピード
                    description: 能力
                  sports:
                    type: string
                    example: 野球、サッカー（GK)、水泳、陸上（砲丸投げ・やり投げ）、柔道、テニス、体操、ラグビー、剣道、スケート（スピード・ショートトラック）、レスリング、ハンドボール、ボクシング、ゴルフ、アメリカンフットボール、ウエイトリフティング、アイスホッケー、ホッケー、アーチェリー、ノルディック複合、ボート、カヌー、セーリング
                    description: スポーツ
                required:
                  - ability
                  - sports
                description: 活かせる能力
              minItems: 3
              maxItems: 3
              description: 活かせる能力（上位3つ）
          required:
            - summary
            - recommend_sports
            - recommend_ability
          description: アドバイス
      required:
        - participant_id
        - meet_id
        - measurement_id
        - meet_name
        - start_date
        - name
        - sex
        - grade
        - birthday
        - participate_time
        - height
        - weight
        - sports_type
        - sports_type_other
        - team_name
        - version
        - results
        - advice
      description: 測定結果詳細
    MeasurementData:
      type: object
      properties:
        grade:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
            - 5
          description: 5段階評価
        score:
          type: number
          format: float
          example: 2.15
          description: 測定値
        rank:
          type: integer
          example: 7
          description: 全国ランキング
        rank_range:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
          description: "全国ランキングの範囲（1: 6〜8才、2: 9〜11才、3: 12〜14才, 4: 15〜）"
      required:
        - grade
        - score
        - rank
        - rank_range
      description: 能力測定データ
    MeasurementMeet:
      type: object
      properties:
        meet_id:
          type: integer
          example: 868064
          description: 測定会ID
        meet_name:
          type: string
          example: "東京テスト測定会"
          description: 測定会名
        start_date:
          type: string
          format: date
          description: 測定会実施日
        start_time:
          type: array
          items:
            type: string
            example: "10:00"
          description: 開始時間
        status:
          type: integer
          enum:
            - 1
            - 2
          description: "測定会ステータス（1: 募集受付中, 2: 募集終了）"
      required:
        - meet_id
        - meet_name
        - start_date
        - start_time
        - status
      description: 申込受付中測定会
    Ranking:
      type: object
      properties:
        dash_10:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        endurance_long:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        endurance_short:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        jump:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        agility:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        step_visual_response:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        step_power:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        swing_speed:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        balance_l:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        balance_r:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
        balance_lr_difference:
          type: array
          items:
            $ref: "#/components/schemas/RankingData"
      required:
        - dash_10
        - endurance_long
        - endurance_short
        - jump
        - agility
        - step_visual_response
        - step_power
        - swing_speed
        - balance_l
        - balance_r
        - balance_lr_difference
    RankingData:
      type: object
      properties:
        name:
          type: string
          example: "山田一郎"
          description: 測定者名
        sex:
          type: integer
          enum:
            - 1
            - 2
          description: "性別（1:男性, 2:女性）"
        birthday:
          type: string
          format: date
          description: 生年月日
        score:
          type: number
          format: float
          example: 2.15
          description: 測定値
        rank:
          type: integer
          example: 7
          description: 全国ランキング
        rank_range:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
          description: "全国ランキングの範囲（1: 6〜8才、2: 9〜11才、3: 12〜14才, 4: 15〜）"
        meet_name:
          type: string
          example: 東京テスト測定会
          description: 測定会名
        participant_id:
          type: integer
          format: int32
          description: 測定者ID
        meet_id:
          type: integer
          example: 868064
          description: 測定会ID
        measurement_id:
          type: integer
          example: 1
          description: 測定結果ID
      required:
        - name
        - sex
        - birthday
        - score
        - rank
        - rank_range
        - meet_name
        - participant_id
        - meet_id
        - measurement_id
    MeasurementMeetRequest:
      type: object
      properties:
        request_id:
          type: integer
          description: リクエストID
        meet_id:
          type: integer
          example: 868064
          description: 測定会ID
        participant_id:
          type: integer
          format: int32
          description: 測定者ID
        first_hope_time:
          type: string
          example: "10:00"
          description: 第1希望時間
        second_hope_time:
          type: string
          example: "11:00"
          description: 第2希望時間
        third_hope_time:
          type: string
          example: "12:00"
          description: 第3希望時間
        is_win:
          type: integer
          enum:
            - 1
            - 2
          description: "当落選結果（1: 当選, 2: 落選）"
        start_time:
          type: string
          example: "10:00"
          description: 開始時間
        status:
          type: integer
          enum:
            - 1
            - 2
          description: "ステータス（1: 未応募, 2: 応募済み）"
      required:
        - request_id
        - meet_id
        - participant_id
        - first_hope_time
        - second_hope_time
        - third_hope_time
        - is_win
        - start_time
        - status
      description: 申込受付中測定会
    MeasurementMeetRequestData:
      type: object
      properties:
        name:
          type: string
          example: 測定 太郎
          description: 名前
        name_kana:
          type: string
          example: ソクテイ タロウ
          description: 名前（カナ）
        sex:
          type: integer
          enum:
            - 1
            - 2
          description: "性別（1:男性, 2:女性）"
        zip_code1:
          type: string
          example: "102"
          description: 郵便番号1
        zip_code2:
          type: string
          example: "0072"
          description: 郵便番号2
        address:
          type: string
          description: 住所
        telephone:
          type: string
          description: 電話番号
        mail_address:
          type: string
          format: email
          description: メールアドレス
          example: user1@example.com
        parent_name:
          type: string
          description: 保護者氏名
        birthday:
          type: string
          format: date
          description: 生年月日
        first_hope_time:
          type: string
          description: 希望測定開始時間1
        second_hope_time:
          type: string
          description: 希望測定開始時間2
        third_hope_time:
          type: string
          description: 希望測定開始時間3
        sports_type:
          type: array
          items:
            type: string
            example: サッカー
          description: 習ったスポーツ
        sports_type_other:
          type: string
          example: フットサル
          description: その他の習ったスポーツ
        school_name:
          type: string
          description: 学校名
        team_name:
          type: string
          description: 所属チーム
        height:
          type: number
          format: float
          example: 145.0
          description: 身長(cm)
        weight:
          type: number
          format: float
          example: 50.0
          description: 体重(kg)
        participate_time:
          type: integer
          format: int32
          example: 1
          description: 参加回数
        endurance_long_self:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
            - 5
          description: "長距離走について（1: 非常に苦手, 2: 少し苦手, 3: 普通, 4: 少し得意, 5: 非常に得意）"
      required:
        - name
        - name_kana
        - sex
        - zip_code1
        - zip_code2
        - address
        - telephone
        - mail_address
        - parent_name
        - birthday
        - first_hope_time
        - second_hope_time
        - third_hope_time
        - sports_type
        - sports_type_other
        - school_name
        - team_name
        - height
        - weight
        - participate_time
        - endurance_long_self
      description: 測定会申込み
security:
  - ApiKeyAuth: []
paths:
  /api/v1/participants:
    get:
      tags:
        - DosaAdmin
      summary: 測定者情報一覧取得
      operationId: getParticipants
      parameters:
        - name: mail_address
          in: query
          description: メールアドレス
          required: false
          schema:
            type: string
            format: email
          example: user1@example.com
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Participant"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: Participant not found
  /api/v1/participants/{participant_id}/measurement_meets:
    get:
      tags:
        - DosaAdmin
      summary: 参加測定会一覧取得
      operationId: getParticipatedMeasurementMeets
      parameters:
        - name: participant_id
          description: 測定者ID
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ParticipantMeasurementMeet"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: ParticipantMeasurementMeet not found
  ? /api/v1/participants/{participant_id}/measurement_meets/{meet_id}/measurements/{measurement_id}
  : get:
      tags:
        - DosaAdmin
      summary: 測定結果取得
      operationId: getMeasurement
      parameters:
        - name: participant_id
          description: 測定者ID
          in: path
          required: true
          schema:
            type: integer
        - name: meet_id
          in: path
          description: 測定会ID
          required: true
          schema:
            type: integer
            example: 693712
        - name: measurement_id
          in: path
          description: 測定結果ID
          required: true
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Measurement"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: Measurement not found
  /api/v1/measurement_meets:
    get:
      tags:
        - DosaAdmin
      summary: 測定会一覧取得
      operationId: getMeasurementMeets
      parameters:
        - name: status
          in: query
          description: "測定会ステータス（1: 募集受付中, 2: 募集終了）"
          required: false
          schema:
            type: integer
            enum:
              - 1
              - 2
            example: 1
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/MeasurementMeet"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: MeasurementMeet not found
  /api/v1/measurement_meets/{meet_id}:
    get:
      tags:
        - DosaAdmin
      summary: 測定会取得
      operationId: getMeasurementMeet
      parameters:
        - name: meet_id
          in: path
          description: 測定会ID
          required: true
          schema:
            type: integer
            example: 868064
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/MeasurementMeet"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: MeasurementMeet not found
  /api/v1/participants/{participant_id}/measurement_meet_requests:
    get:
      tags:
        - DosaAdmin
      summary: 申込み測定会一覧取得
      operationId: getMeasurementMeetRequest
      parameters:
        - name: participant_id
          in: path
          description: 測定者ID
          required: true
          schema:
            type: integer
            format: int32
        - name: meet_id
          in: query
          description: 測定会ID
          required: false
          schema:
            type: integer
            example: 868064
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/MeasurementMeetRequest"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: MeasurementMeetRequest not found
  /api/v1/rankings:
    get:
      tags:
        - DosaAdmin
      summary: ランキング一覧取得
      operationId: getRankings
      parameters:
        - name: rank_range
          in: query
          schema:
            type: integer
            enum:
              - 1
              - 2
              - 3
              - 4
          description: "全国ランキングの範囲（1: 6〜8才、2: 9〜11才、3: 12〜14才, 4: 15〜）"
        - name: sex
          in: query
          schema:
            type: integer
            enum:
              - 1
              - 2
          description: "性別（1:男性, 2:女性）"
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Ranking"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: Ranking not found
  /api/v1/meaasuremnt_meets/{meet_id}:
    post:
      tags:
        - DosaAdmin
      summary: 測定会申込み
      operationId: postMeasurementMeet
      parameters:
        - name: meet_id
          in: path
          description: 測定会ID
          required: true
          schema:
            type: integer
            example: 868064
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MeasurementMeetRequestData"
      responses:
        "201":
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  request_id:
                    type: integer
                    description: リクエストID
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: MeasurementMeet not found
  /api/v1/send_test_mail:
    post:
      tags:
        - DosaAdmin
      summary: テストメール送信
      operationId: postSendTestMail
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                mail_address:
                  type: string
                  format: email
                  example: user1@example.com
      responses:
        "200":
          description: ok
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          description: MeasurementMeet not found
